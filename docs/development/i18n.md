# i18n

The MVP is English-only, but we set up i18n scaffolding early to avoid refactors later.

See:

- `docs/adr/0018-i18n-paraglide.md` for the library choice.
- `docs/adr/0017-locale-storage.md` for locale storage strategy.
- `docs/development/emails.md` for email localization.

## Conventions

- Use Paraglide for message management and locale detection.
- Use `src/lib/i18n.ts` for formatting helpers.
- Store messages in `messages/en-US.json` for English.
- Use `Intl` for number, currency, and date formatting.
- Email templates can use Paraglide messages and should render through
  `src/modules/auth/email-render.ts` for locale + plain text output.

## Defaults

- Locale: `en-US` (per `docs/adr/0017-locale-storage.md`)
- Currency: `USD`
- Time zone defaults: see `docs/development/timezones.md`.

## Emails

- Locale resolution order for emails:
  `locale` param → `APP_LOCALE` cookie → `user_preferences.locale` →
  runtime `getLocale()` → `baseLocale`.
  `renderEmail` handles the runtime locale fallback to `baseLocale`.
  `user_preferences.locale` is only checked when a user ID is available.
  Runtime `getLocale()` is only consulted by `renderEmail` when
  `email-service` resolves no locale.
- See `docs/development/emails.md` for template conventions and examples.

## Usage

```ts
import { formatCurrency, formatDate } from '@/lib/i18n';
import { appTitle } from '@/paraglide/messages';

const label = appTitle();
const amount = formatCurrency({ amountCents: 1299, currency: 'USD' });
const date = formatDate({ value: new Date() });
```

Locale cookies use the helpers in `docs/development/cookies.md`.

## Server Entry

We keep `src/server.ts` so Paraglide can wrap the request handler with
`paraglideMiddleware`. This reads cookies/headers before rendering and ensures
the locale is available on the server.

## Paraglide Build

Compile Paraglide output if you need generated files in the repo:

```bash
pnpm paraglide:compile
```

Note: Paraglide generates JS output; `tsconfig.json` enables `allowJs`.

## Future Expansion

- Add new locale files in `messages/`.
- Expand locales in `project.inlang/settings.json`.
- Consider URL-based locales if we need public SEO later.
